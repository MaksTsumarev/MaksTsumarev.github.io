<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расчет формулы</title>
    <script>
        // Функция для расчета
        function calculate() {
            // Получаем значения из полей ввода
            var N = parseFloat(document.getElementById("inputN").value);
            var D = parseFloat(document.getElementById("inputD").value);
            var article = document.getElementById("inputArticle").value;
            var lot = document.getElementById("inputLot").value;

            // Проверяем, что значения корректные
            if (isNaN(D) || isNaN(N) || N === 0 || article === "" || lot === "") {
                alert("Пожалуйста, введите правильные значения для всех полей!");
                return;
            }

            // Расчет по формуле
            var result = (Math.PI * Math.pow(D, 2) * N) / 4;

            // Загружаем сохраненные данные из localStorage
            var history = localStorage.getItem("history");
            if (history === null) {
                history = {};  // Если истории нет, создаем новый объект
            } else {
                history = JSON.parse(history); // Если история есть, преобразуем её из JSON в объект
            }

            // Добавляем новый расчет в историю для текущего артикула
            if (!history[article]) {
                history[article] = []; // Если для артикула еще нет истории, создаем массив
            }

            // Добавляем новый расчет в историю
            history[article].push({ lot: lot, result: result.toFixed(4) });

            // Сохраняем обновленную историю в localStorage
            localStorage.setItem("history", JSON.stringify(history));

            // Отображаем результат
            document.getElementById("result").innerText = "Результат: " + result.toFixed(4);
            displayHistory(article);
        }

        // Функция для отображения истории расчетов для артикула
        function displayHistory(article) {
            // Загружаем историю из localStorage
            var history = localStorage.getItem("history");
            if (history === null) {
                history = {};  // Если истории нет, создаем новый объект
            } else {
                history = JSON.parse(history); // Если история есть, преобразуем её из JSON в объект
            }

            // Получаем элементы для вывода
            var historyElement = document.getElementById("history");

            // Очищаем старую историю
            historyElement.innerHTML = "";

            // Проверяем, есть ли история для выбранного артикула
            if (history[article]) {
                var historyList = history[article];
                // Для каждого расчета выводим новый элемент списка
                historyList.forEach(function(item, index) {
                    var historyItem = document.createElement("p");
                    historyItem.innerText = `LOT#: ${item.lot}, Результат: ${item.result}`;

                    // Создаем кнопку для удаления записи
                    var deleteButton = document.createElement("button");
                    deleteButton.innerText = "Удалить";
                    deleteButton.onclick = function() {
                        deleteHistory(article, index);  // Удалить из истории
                    };

                    // Добавляем кнопку удаления рядом с элементом
                    historyItem.appendChild(deleteButton);
                    historyElement.appendChild(historyItem);
                });
            } else {
                historyElement.innerText = "Нет истории для данного артикула.";
            }
        }

        // Функция для удаления записи из истории
        function deleteHistory(article, index) {
            // Загружаем историю из localStorage
            var history = localStorage.getItem("history");
            if (history === null) {
                history = {};  // Если истории нет, создаем новый объект
            } else {
                history = JSON.parse(history); // Если история есть, преобразуем её из JSON в объект
            }

            // Удаляем элемент по индексу
            if (history[article] && history[article].length > index) {
                history[article].splice(index, 1);  // Удаляем элемент из массива
            }

            // Сохраняем обновленную историю в localStorage
            localStorage.setItem("history", JSON.stringify(history));

            // Перерисовываем историю
            displayHistory(article);
        }

        // Функция для загрузки истории при открытии страницы
        function loadSavedData() {
            var article = document.getElementById("inputArticle").value;
            displayHistory(article);
        }
    </script>
</head>
<body onload="loadSavedData()">
    <h1>Расчет формулы</h1>

    <label for="inputN">Введите количество жил N:</label>
    <input type="number" id="inputN" required>
    <br><br>

    <label for="inputD">Введите диаметр D:</label>
    <input type="number" id="inputD" required>
    <br><br>

    <label for="inputArticle">Артикул:</label>
    <input type="text" id="inputArticle" required oninput="loadSavedData()">
    <br><br>

    <label for="inputLot">LOT#:</label>
    <input type="text" id="inputLot" required>
    <br><br>

    <button onclick="calculate()">Рассчитать</button>

    <p id="result"></p>

    <h2>История расчетов для артикула:</h2>
    <div id="history"></div>
</body>
</html>
